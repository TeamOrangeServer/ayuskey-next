(self.webpackChunkmisskey=self.webpackChunkmisskey||[]).push([[1377,7505],{26051:(e,t,o)=>{var a=o(23645)((function(e){return e[1]}));a.push([e.id,'.eiipwacr[data-v-bcae1c0a]{position:relative;margin:32px 0}.eiipwacr[data-v-bcae1c0a]:not(.inline):first-child{margin-top:8px}.eiipwacr[data-v-bcae1c0a]:not(.inline):last-child{margin-bottom:8px}.eiipwacr>.icon[data-v-bcae1c0a]{position:absolute;top:0;left:0;width:24px;text-align:center;line-height:32px}.eiipwacr>.icon:not(:empty)+.input[data-v-bcae1c0a]{margin-left:28px}.eiipwacr>.input[data-v-bcae1c0a]{display:flex;position:relative}.eiipwacr>.input[data-v-bcae1c0a]:before{content:"";display:block;position:absolute;bottom:0;left:0;right:0;height:1px;background:var(--inputBorder)}.eiipwacr>.input[data-v-bcae1c0a]:after{content:"";display:block;position:absolute;bottom:0;left:0;right:0;height:2px;background:var(--accent);opacity:0;transform:scaleX(.12);transition:border .3s cubic-bezier(.4,0,.2,1),opacity .3s cubic-bezier(.4,0,.2,1),transform .3s cubic-bezier(.4,0,.2,1);will-change:border opacity transform}.eiipwacr>.input>.label[data-v-bcae1c0a]{position:absolute;top:0;left:0;transition:.4s cubic-bezier(.25,.8,.25,1);transition-duration:.3s;font-size:1em;line-height:32px;pointer-events:none;transform-origin:top left;transform:scale(1)}.eiipwacr>.input>select[data-v-bcae1c0a]{display:block;flex:1;width:100%;padding:0;font:inherit;font-weight:400;font-size:1em;height:32px;background:none;border:none;border-radius:0;outline:none;box-shadow:none;appearance:none;-webkit-appearance:none;color:var(--fg)}.eiipwacr>.input>select optgroup[data-v-bcae1c0a],.eiipwacr>.input>select option[data-v-bcae1c0a]{color:var(--fg);background:var(--bg)}.eiipwacr>.input>.prefix[data-v-bcae1c0a],.eiipwacr>.input>.suffix[data-v-bcae1c0a]{display:block;align-self:center;justify-self:center;font-size:1em;line-height:32px;color:var(--inputLabel);pointer-events:none}.eiipwacr>.input>.prefix[data-v-bcae1c0a]:empty,.eiipwacr>.input>.suffix[data-v-bcae1c0a]:empty{display:none}.eiipwacr>.input>.prefix>*[data-v-bcae1c0a],.eiipwacr>.input>.suffix>*[data-v-bcae1c0a]{display:block;min-width:16px}.eiipwacr>.input>.prefix[data-v-bcae1c0a]{padding-right:4px}.eiipwacr>.input>.suffix[data-v-bcae1c0a]{padding-left:4px}.eiipwacr>.text[data-v-bcae1c0a]{margin:6px 0;font-size:.8em}.eiipwacr>.text[data-v-bcae1c0a]:empty{display:none}.eiipwacr>.text *[data-v-bcae1c0a]{margin:0}.eiipwacr.focused>.input[data-v-bcae1c0a]:after{opacity:1;transform:scaleX(1)}.eiipwacr.focused>.input>.label[data-v-bcae1c0a]{color:var(--accent)}.eiipwacr.filled>.input>.label[data-v-bcae1c0a],.eiipwacr.focused>.input>.label[data-v-bcae1c0a]{top:-17px;left:0!important;transform:scale(.75)}',""]),e.exports=a},12050:(e,t,o)=>{var a=o(23645)((function(e){return e[1]}));a.push([e.id,".hveuntkp[data-v-44801dd2]{position:relative;min-height:500px}.hveuntkp[data-v-44801dd2]> canvas{display:block}",""]),e.exports=a},29796:e=>{e.exports=[{id:"milk",place:"floor"},{id:"bed",place:"floor"},{id:"low-table",place:"floor",props:{color:"color"},color:{Table:"color"}},{id:"desk",place:"floor",props:{color:"color"},color:{Board:"color"}},{id:"chair",place:"floor",props:{color:"color"},color:{Chair:"color"}},{id:"chair2",place:"floor",props:{color1:"color",color2:"color"},color:{Cushion:"color1",Leg:"color2"}},{id:"fan",place:"wall"},{id:"pc",place:"floor"},{id:"plant",place:"floor"},{id:"plant2",place:"floor"},{id:"eraser",place:"floor"},{id:"pencil",place:"floor"},{id:"pudding",place:"floor"},{id:"cardboard-box",place:"floor"},{id:"cardboard-box2",place:"floor"},{id:"cardboard-box3",place:"floor"},{id:"book",place:"floor",props:{color:"color"},color:{Cover:"color"}},{id:"book2",place:"floor"},{id:"piano",place:"floor"},{id:"facial-tissue",place:"floor"},{id:"server",place:"floor"},{id:"moon",place:"floor"},{id:"corkboard",place:"wall"},{id:"mousepad",place:"floor",props:{color:"color"},color:{Pad:"color"}},{id:"monitor",place:"floor",props:{screen:"image"},texture:{Screen:{prop:"screen",uv:{x:0,y:434,width:1024,height:588}}}},{id:"tv",place:"floor",props:{screen:"image"},texture:{Screen:{prop:"screen",uv:{x:0,y:434,width:1024,height:588}}}},{id:"keyboard",place:"floor"},{id:"carpet-stripe",place:"floor",props:{color1:"color",color2:"color"},color:{CarpetAreaA:"color1",CarpetAreaB:"color2"}},{id:"mat",place:"floor",props:{color:"color"},color:{Mat:"color"}},{id:"color-box",place:"floor",props:{color:"color"},color:{main:"color"}},{id:"wall-clock",place:"wall"},{id:"cube",place:"floor",props:{color:"color"},color:{Cube:"color"}},{id:"photoframe",place:"wall",props:{photo:"image",color:"color"},texture:{Photo:{prop:"photo",uv:{x:0,y:342,width:1024,height:683}}},color:{Frame:"color"}},{id:"pinguin",place:"floor",props:{body:"color",belly:"color"},color:{Body:"body",Belly:"belly"}},{id:"rubik-cube",place:"floor"},{id:"poster-h",place:"wall",props:{picture:"image"},texture:{Poster:{prop:"picture",uv:{x:0,y:277,width:1024,height:745}}}},{id:"poster-v",place:"wall",props:{picture:"image"},texture:{Poster:{prop:"picture",uv:{x:0,y:0,width:745,height:1024}}}},{id:"sofa",place:"floor",props:{color:"color"},color:{Sofa:"color"}},{id:"spiral",place:"floor",props:{color:"color"},color:{Step:"color"}},{id:"bin",place:"floor",props:{color:"color"},color:{Bin:"color"}},{id:"cup-noodle",place:"floor"},{id:"holo-display",place:"floor",props:{image:"image"},texture:{Image_Front:{prop:"image",uv:{x:0,y:0,width:1024,height:1024}},Image_Back:{prop:"image",uv:{x:0,y:0,width:1024,height:1024}}}},{id:"energy-drink",place:"floor"},{id:"doll-ai",place:"floor"},{id:"banknote",place:"floor"}]},66018:(e,t,o)=>{"use strict";o.d(t,{Z:()=>u});var a=o(55393);const r=(0,a.withScopeId)("data-v-bcae1c0a");(0,a.pushScopeId)("data-v-bcae1c0a");const i={class:"icon",ref:"icon"},s={class:"label",ref:"label"},n={class:"prefix",ref:"prefix"},l={class:"suffix"},c={class:"text"};(0,a.popScopeId)();const d=r(((e,t,o,r,d,p)=>{const h=(0,a.resolveComponent)("Fa");return(0,a.openBlock)(),(0,a.createBlock)("div",{class:["eiipwacr",{focused:e.focused,disabled:e.disabled,filled:e.filled,inline:e.inline}]},[(0,a.createVNode)("div",i,[(0,a.renderSlot)(e.$slots,"icon")],512),(0,a.createVNode)("div",{class:"input",onClick:t[4]||(t[4]=(...t)=>e.focus&&e.focus(...t))},[(0,a.createVNode)("span",s,[(0,a.renderSlot)(e.$slots,"label")],512),(0,a.createVNode)("div",n,[(0,a.renderSlot)(e.$slots,"prefix")],512),(0,a.withDirectives)((0,a.createVNode)("select",{ref:"input","onUpdate:modelValue":t[1]||(t[1]=t=>e.v=t),required:e.required,disabled:e.disabled,onFocus:t[2]||(t[2]=t=>e.focused=!0),onBlur:t[3]||(t[3]=t=>e.focused=!1)},[(0,a.renderSlot)(e.$slots,"default")],40,["required","disabled"]),[[a.vModelSelect,e.v]]),(0,a.createVNode)("div",l,[(0,a.renderSlot)(e.$slots,"suffix",{},(()=>[(0,a.createVNode)(h,{icon:e.faChevronDown},null,8,["icon"])]))])]),(0,a.createVNode)("div",c,[(0,a.renderSlot)(e.$slots,"text")])],2)}));var p=o(51436);const h=(0,a.defineComponent)({props:{value:{required:!1},required:{type:Boolean,required:!1},disabled:{type:Boolean,required:!1},inline:{type:Boolean,required:!1,default:!1}},data:()=>({focused:!1,faChevronDown:p.ptq}),computed:{v:{get(){return this.value},set(e){this.$emit("update:value",e)}},filled:()=>!0},mounted(){this.$refs.prefix&&(this.$refs.label.style.left=this.$refs.prefix.offsetLeft+this.$refs.prefix.offsetWidth+"px")},methods:{focus(){this.$refs.input.focus()}}});o(33599);h.render=d,h.__scopeId="data-v-bcae1c0a";const u=h},17505:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>n});var a=o(55393);const r={width:"224",height:"128"};var i=o(2212);const s=(0,a.defineComponent)({data:()=>({selected:null,objectHeight:0,orbitRadius:5}),mounted(){const e=this.$el,t=e.width,o=e.height,a=new i.xsS,r=new i.CP7({canvas:e,antialias:!0,alpha:!1});r.setPixelRatio(window.devicePixelRatio),r.setSize(t,o),r.setClearColor(0),r.autoClear=!1,r.shadowMap.enabled=!0,r.shadowMap.cullFace=i.tm_;const s=new i.cPb(75,t/o,.1,100);s.zoom=10,s.position.x=0,s.position.y=2,s.position.z=0,s.updateProjectionMatrix(),a.add(s);const n=new i.Mig(16777215,1);n.castShadow=!1,a.add(n);const l=new i.cek(16777215,1,100);l.position.set(3,3,3),a.add(l);const c=new i.VLJ(5,16,4473924,2236962);a.add(c);const d=()=>{const e=4e-4*Date.now();requestAnimationFrame(d),s.position.y=Math.sin(Math.PI/6)*this.orbitRadius,s.position.z=Math.cos(e)*this.orbitRadius,s.position.x=Math.sin(e)*this.orbitRadius,s.lookAt(new i.Pa4(0,this.objectHeight/2,0)),r.render(a,s)};this.selected=e=>{const t=e.clone(),o=a.getObjectByName("obj");null!=o&&a.remove(o),t.name="obj",t.position.x=0,t.position.y=0,t.position.z=0,t.rotation.x=0,t.rotation.y=0,t.rotation.z=0,t.traverse((e=>{if(e instanceof i.Kj0)return e.material=e.material.clone(),e.material.emissive.setHex(0)}));const r=(new i.ZzF).setFromObject(t);this.objectHeight=r.max.y-r.min.y;const n=r.max.x-r.min.x,l=r.max.z-r.min.z,c=Math.hypot(n,l)/s.aspect;this.orbitRadius=Math.max(c,this.objectHeight)*s.zoom*.625/Math.tan(.5*s.fov*(Math.PI/180)),a.add(t)},d()}});s.render=function(e,t,o,i,s,n){return(0,a.openBlock)(),(0,a.createBlock)("canvas",r)};const n=s},61377:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>K});var a=o(55393);const r=(0,a.withScopeId)("data-v-44801dd2");(0,a.pushScopeId)("data-v-44801dd2");const i={class:"hveuntkp"},s={key:0,class:"controller _section"},n={class:"_content"},l={class:"name"},c={class:"_content"},d={class:"_content"},p={key:1,class:"menu _section"},h={class:"_content"},u={class:"_content"},m={value:"default"},f={value:"washitsu"},g={key:0},y={class:"_content"};(0,a.popScopeId)();const b=r(((e,t,o,b,w,v)=>{const x=(0,a.resolveComponent)("XPreview"),C=(0,a.resolveComponent)("MkButton"),k=(0,a.resolveComponent)("Fa"),S=(0,a.resolveComponent)("MkSelect");return(0,a.openBlock)(),(0,a.createBlock)("div",i,[e.objectSelected?((0,a.openBlock)(),(0,a.createBlock)("div",s,[(0,a.createVNode)("div",n,[(0,a.createVNode)("p",l,(0,a.toDisplayString)(e.selectedFurnitureName),1),(0,a.createVNode)(x,{ref:"preview"},null,512),e.selectedFurnitureInfo.props?((0,a.openBlock)(!0),(0,a.createBlock)(a.Fragment,{key:0},(0,a.renderList)(Object.keys(e.selectedFurnitureInfo.props),(t=>((0,a.openBlock)(),(0,a.createBlock)("div",{key:t},[(0,a.createVNode)("p",null,(0,a.toDisplayString)(t),1),"image"===e.selectedFurnitureInfo.props[t]?((0,a.openBlock)(),(0,a.createBlock)(C,{key:0,onClick:o=>e.chooseImage(t,o)},{default:r((()=>[(0,a.createTextVNode)((0,a.toDisplayString)(e.$ts._rooms.chooseImage),1)])),_:2},1032,["onClick"])):"color"===e.selectedFurnitureInfo.props[t]?((0,a.openBlock)(),(0,a.createBlock)("input",{key:1,type:"color",value:e.selectedFurnitureProps?e.selectedFurnitureProps[t]:null,onChange:o=>e.updateColor(t,o)},null,40,["value","onChange"])):(0,a.createCommentVNode)("",!0)])))),128)):(0,a.createCommentVNode)("",!0)]),(0,a.createVNode)("div",c,[(0,a.createVNode)(C,{inline:"",onClick:t[1]||(t[1]=t=>e.translate()),primary:e.isTranslateMode},{default:r((()=>[(0,a.createVNode)(k,{icon:e.faArrowsAlt},null,8,["icon"]),(0,a.createTextVNode)(" "+(0,a.toDisplayString)(e.$ts._rooms.translate),1)])),_:1},8,["primary"]),(0,a.createVNode)(C,{inline:"",onClick:t[2]||(t[2]=t=>e.rotate()),primary:e.isRotateMode},{default:r((()=>[(0,a.createVNode)(k,{icon:e.faUndo},null,8,["icon"]),(0,a.createTextVNode)(" "+(0,a.toDisplayString)(e.$ts._rooms.rotate),1)])),_:1},8,["primary"]),e.isTranslateMode||e.isRotateMode?((0,a.openBlock)(),(0,a.createBlock)(C,{key:0,inline:"",onClick:t[3]||(t[3]=t=>e.exit())},{default:r((()=>[(0,a.createVNode)(k,{icon:e.faBan},null,8,["icon"]),(0,a.createTextVNode)(" "+(0,a.toDisplayString)(e.$ts._rooms.exit),1)])),_:1})):(0,a.createCommentVNode)("",!0)]),(0,a.createVNode)("div",d,[(0,a.createVNode)(C,{onClick:t[4]||(t[4]=t=>e.remove())},{default:r((()=>[(0,a.createVNode)(k,{icon:e.faTrashAlt},null,8,["icon"]),(0,a.createTextVNode)(" "+(0,a.toDisplayString)(e.$ts._rooms.remove),1)])),_:1})])])):(0,a.createCommentVNode)("",!0),e.isMyRoom?((0,a.openBlock)(),(0,a.createBlock)("div",p,[(0,a.createVNode)("div",h,[(0,a.createVNode)(C,{onClick:t[5]||(t[5]=t=>e.add())},{default:r((()=>[(0,a.createVNode)(k,{icon:e.faBoxOpen},null,8,["icon"]),(0,a.createTextVNode)(" "+(0,a.toDisplayString)(e.$ts._rooms.addFurniture),1)])),_:1})]),(0,a.createVNode)("div",u,[(0,a.createVNode)(S,{value:e.roomType,"onUpdate:value":t[6]||(t[6]=t=>e.updateRoomType(t))},{label:r((()=>[(0,a.createTextVNode)((0,a.toDisplayString)(e.$ts._rooms.roomType),1)])),default:r((()=>[(0,a.createVNode)("option",m,(0,a.toDisplayString)(e.$ts._rooms._roomType.default),1),(0,a.createVNode)("option",f,(0,a.toDisplayString)(e.$ts._rooms._roomType.washitsu),1)])),_:1},8,["value"]),"default"===e.roomType?((0,a.openBlock)(),(0,a.createBlock)("label",g,[(0,a.createVNode)("span",null,(0,a.toDisplayString)(e.$ts._rooms.carpetColor),1),(0,a.createVNode)("input",{type:"color",value:e.carpetColor,onChange:t[7]||(t[7]=t=>e.updateCarpetColor(t))},null,40,["value"])])):(0,a.createCommentVNode)("",!0)]),(0,a.createVNode)("div",y,[(0,a.createVNode)(C,{inline:"",disabled:!e.changed,primary:"",onClick:t[8]||(t[8]=t=>e.save())},{default:r((()=>[(0,a.createVNode)(k,{icon:e.faSave},null,8,["icon"]),(0,a.createTextVNode)(" "+(0,a.toDisplayString)(e.$ts.save),1)])),_:1},8,["disabled"]),(0,a.createVNode)(C,{inline:"",onClick:t[9]||(t[9]=t=>e.clear())},{default:r((()=>[(0,a.createVNode)(k,{icon:e.faBroom},null,8,["icon"]),(0,a.createTextVNode)(" "+(0,a.toDisplayString)(e.$ts._rooms.clear),1)])),_:1})])])):(0,a.createCommentVNode)("",!0)])}));var w=o(88572),v=o(44586),x=o(2212),C=o(17047),k=o(52886),S=o(32050),F=o(86426),j=o(15980),M=o(84894),T=o(45441),P=o(83633),N=o(2078),B=function(e,t,o,a){var r,i=arguments.length,s=i<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,o):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,a);else for(var n=e.length-1;n>=0;n--)(r=e[n])&&(s=(i<3?r(s):i>3?r(t,o,s):r(t,o))||s);return i>3&&s&&Object.defineProperty(t,o,s),s};const V=o(29796);x.PpQ.crossOrigin="";class I{constructor(e,t,o,a,r){this.mixers=[],this.objects=[],this.selectedObject=null,this.isTransformMode=!1,this.roomInfo=o,this.graphicsQuality=r.graphicsQuality,this.onChangeSelect=r.onChangeSelect,this.clock=new x.SUY(!0),this.scene=new x.xsS;const i=a.clientWidth,s=a.clientHeight;this.renderer=new x.CP7({antialias:!1,stencil:!1,alpha:!1,powerPreference:"ultra"===this.graphicsQuality||"high"===this.graphicsQuality?"high-performance":"medium"===this.graphicsQuality?"default":(this.graphicsQuality,"low-power")}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(i,s),this.renderer.autoClear=!1,this.renderer.setClearColor(new x.Ilk(335661)),this.renderer.shadowMap.enabled=this.enableShadow,this.renderer.shadowMap.type="ultra"===this.graphicsQuality||"high"===this.graphicsQuality?x.ntZ:"medium"===this.graphicsQuality?x._iA:(this.graphicsQuality,x._MY),a.insertBefore(this.canvas,a.firstChild),this.camera=r.useOrthographicCamera?new x.iKG(i/-2,i/2,s/2,s/-2,-10,10):new x.cPb(45,i/s),r.useOrthographicCamera?(this.camera.position.x=2,this.camera.position.y=2,this.camera.position.z=2,this.camera.zoom=100,this.camera.updateProjectionMatrix()):(this.camera.position.x=5,this.camera.position.y=2,this.camera.position.z=5),this.scene.add(this.camera);const n=new x.Mig(16777215,1);if(this.scene.add(n),"cheep"!==this.graphicsQuality){const e=new x.PMe(16777215,.1);e.position.set(0,8,0),e.castShadow=this.enableShadow,e.shadow.bias=-1e-4,e.shadow.mapSize.width=this.shadowQuality,e.shadow.mapSize.height=this.shadowQuality,e.shadow.camera.near=.1,e.shadow.camera.far=9,e.shadow.camera.fov=45,this.scene.add(e)}const l=new x.PMe(16777215,.4);l.position.set(9,3,-2),l.castShadow=this.enableShadow,l.shadow.bias=-.001,l.shadow.mapSize.width=this.shadowQuality,l.shadow.mapSize.height=this.shadowQuality,l.shadow.camera.near=6,l.shadow.camera.far=15,l.shadow.camera.fov=45,this.scene.add(l);const c=new x.PMe(16777215,.2);if(c.position.set(-2,3,9),c.castShadow=!1,c.shadow.bias=-.001,c.shadow.camera.near=6,c.shadow.camera.far=15,c.shadow.camera.fov=45,this.scene.add(c),this.controls=new k.z(this.camera,this.canvas),this.controls.target.set(0,1,0),this.controls.enableZoom=!0,this.controls.enablePan=t,this.controls.minPolarAngle=0,this.controls.maxPolarAngle=Math.PI/2,this.controls.minAzimuthAngle=0,this.controls.maxAzimuthAngle=Math.PI/2,this.controls.enableDamping=!0,this.controls.dampingFactor=.2,this.usePostFXs){const e=new x.dd2(i,s,{minFilter:x.wem,magFilter:x.wem,format:x.UCm,stencilBuffer:!1}),t=new j.T(T.C);t.uniforms.resolution.value=new x.FM8(1/i,1/s),t.renderToScreen=!0,this.composer=new S.x(this.renderer,e),this.composer.addPass(new F.C(this.scene,this.camera)),"ultra"===this.graphicsQuality&&this.composer.addPass(new M.y(.25,30,128,512)),this.composer.addPass(t)}else this.composer=null;const d="/proxy/?"+(0,N.I)({url:e.avatarUrl}),p=new x.dpR;p.crossOrigin="anonymous";const h=p.load(d);h.wrapS=x.rpg,h.wrapT=x.rpg,h.anisotropy=16;const u=new x.vBJ({map:h,side:x.ehD,alphaTest:.5}),m=new x._12(1,1),f=new x.Kj0(m,u);f.position.set(-3,2.5,2),f.rotation.y=Math.PI/2,f.castShadow=!1,this.scene.add(f);const g=e.username;(new x.JfN).load("/assets/fonts/helvetiker_regular.typeface.json",(e=>{const t=new x.MP$(g,{size:.5,height:0,curveSegments:8,font:e,bevelThickness:0,bevelSize:0,bevelEnabled:!1}),o=new x.YBo({color:16777215}),a=new x.Kj0(t,o);a.position.set(-3,2.25,1.25),a.rotation.y=Math.PI/2,a.castShadow=!1,this.scene.add(a)})),t&&(this.furnitureControl=new P.Ys(this.camera,this.canvas),this.scene.add(this.furnitureControl),this.canvas.onmousemove=this.onmousemove,this.canvas.onmousedown=this.onmousedown),this.loadRoom();for(const e of this.furnitures)this.loadFurniture(e).then((e=>{this.scene.add(e.scene),this.objects.push(e.scene)}));this.usePostFXs?this.renderWithPostFXs():this.renderWithoutPostFXs()}get canvas(){return this.renderer.domElement}get furnitures(){return this.roomInfo.furnitures}set furnitures(e){this.roomInfo.furnitures=e}get enableShadow(){return"cheep"!=this.graphicsQuality}get usePostFXs(){return"cheep"!==this.graphicsQuality&&"low"!==this.graphicsQuality}get shadowQuality(){return"ultra"===this.graphicsQuality?16384:"high"===this.graphicsQuality?8192:"medium"===this.graphicsQuality?4096:"low"===this.graphicsQuality?1024:0}renderWithoutPostFXs(){this.renderFrameRequestId=window.requestAnimationFrame(this.renderWithoutPostFXs);const e=this.clock.getDelta();for(const t of this.mixers)t.update(e);this.controls.update(),this.renderer.render(this.scene,this.camera)}renderWithPostFXs(){this.renderFrameRequestId=window.requestAnimationFrame(this.renderWithPostFXs);const e=this.clock.getDelta();for(const t of this.mixers)t.update(e);this.controls.update(),this.renderer.clear(),this.composer.render()}loadRoom(){const e=this.roomInfo.roomType;(new C.E).load(`/assets/room/rooms/${e}/${e}.glb`,(e=>{e.scene.traverse((e=>{e instanceof x.Kj0&&(e.receiveShadow=this.enableShadow,e.material=new x.YBo({color:e.material.color,map:e.material.map,name:e.material.name}),e.material.map&&"cheep"!==this.graphicsQuality&&(e.material.map.minFilter=x.FDw,e.material.map.magFilter=x.FDw,e.material.map.anisotropy=8))})),e.scene.position.set(0,0,0),this.scene.add(e.scene),this.roomObj=e.scene,"default"===this.roomInfo.roomType&&this.applyCarpetColor()}))}loadFurniture(e){const t=V.find((t=>t.id===e.type));return new Promise(((o,a)=>{(new C.E).load(`/assets/room/furnitures/${e.type}/${e.type}.glb`,(a=>{const r=a.scene;if(a.animations.length>0){const e=new x.Xcj(r);this.mixers.push(e);for(const t of a.animations)e.clipAction(t).play()}r.name=e.id,r.position.x=e.position.x,r.position.y=e.position.y,r.position.z=e.position.z,r.rotation.x=e.rotation.x,r.rotation.y=e.rotation.y,r.rotation.z=e.rotation.z,r.traverse((e=>{e instanceof x.Kj0&&(e.castShadow=this.enableShadow,e.receiveShadow=this.enableShadow,e.material.metalness=0,e.material.map&&"cheep"!==this.graphicsQuality&&(e.material.map.minFilter=x.FDw,e.material.map.magFilter=x.FDw,e.material.map.anisotropy=8))})),t.color&&this.applyCustomColor(r),t.texture&&this.applyCustomTexture(r),o(a)}),null,a)}))}applyCarpetColor(){this.roomObj.traverse((e=>{if(e instanceof x.Kj0&&e.material&&e.material.name&&"Carpet"===e.material.name){const t=parseInt(this.roomInfo.carpetColor.substr(1),16);e.material.color.setHex(t)}}))}applyCustomColor(e){const t=this.furnitures.find((t=>t.id===e.name)),o=V.find((e=>e.id===t.type));null!=o.color&&e.traverse((e=>{if(e instanceof x.Kj0)for(const a of Object.keys(o.color)){if(!e.material||!e.material.name||e.material.name!==a)continue;const r=o.color[a],i=t.props?t.props[r]:void 0;if(null==i)continue;const s=parseInt(i.substr(1),16);e.material.color.setHex(s)}}))}applyCustomTexture(e){const t=this.furnitures.find((t=>t.id===e.name)),o=V.find((e=>e.id===t.type));null!=o.texture&&e.traverse((e=>{if(e instanceof x.Kj0)for(const a of Object.keys(o.texture)){if(e.name!==a)continue;const r=o.texture[a].prop,i=t.props?t.props[r]:void 0;if(null==i)continue;const s=document.createElement("canvas");s.height=1024,s.width=1024,e.material=new x.YBo({emissive:1118481,side:x.ehD,alphaTest:.5});const n=new Image;n.crossOrigin="anonymous",n.onload=()=>{const t=o.texture[a].uv;s.getContext("2d").drawImage(n,0,0,n.width,n.height,t.x,t.y,t.width,t.height);const r=new x.xEZ(s);r.wrapS=x.rpg,r.wrapT=x.rpg,r.anisotropy=16,r.flipY=!1,e.material.map=r,e.material.needsUpdate=!0,e.material.map.needsUpdate=!0},n.src=i}}))}onmousemove(e){if(this.isTransformMode)return;const t=e.target.getBoundingClientRect(),o=(e.clientX-t.left)/t.width*2-1,a=-(e.clientY-t.top)/t.height*2+1,r=new x.FM8(o,a);this.camera.updateMatrixWorld();const i=new x.iMs;i.setFromCamera(r,this.camera);const s=i.intersectObjects(this.objects,!0);for(const e of this.objects)this.isSelectedObject(e)||e.traverse((e=>{e instanceof x.Kj0&&e.material.emissive.setHex(0)}));if(s.length>0){const e=this.getRoot(s[0].object);if(this.isSelectedObject(e))return;e.traverse((e=>{e instanceof x.Kj0&&e.material.emissive.setHex(1644825)}))}}onmousedown(e){if(this.isTransformMode)return;if(e.target!==this.canvas||0!==e.button)return;const t=e.target.getBoundingClientRect(),o=(e.clientX-t.left)/t.width*2-1,a=-(e.clientY-t.top)/t.height*2+1,r=new x.FM8(o,a);this.camera.updateMatrixWorld();const i=new x.iMs;i.setFromCamera(r,this.camera);const s=i.intersectObjects(this.objects,!0);for(const e of this.objects)e.traverse((e=>{e instanceof x.Kj0&&e.material.emissive.setHex(0)}));if(s.length>0){const e=this.getRoot(s[0].object);this.selectFurniture(e)}else this.selectedObject=null,this.onChangeSelect(null)}getRoot(e){let t=!1,o=e.parent;for(;!t;)null==o.parent.parent?t=!0:o=o.parent;return o}isSelectedObject(e){return null!=this.selectedObject&&e.name===this.selectedObject.name}selectFurniture(e){this.selectedObject=e,this.onChangeSelect(e),e.traverse((e=>{e instanceof x.Kj0&&e.material.emissive.setHex(16711680)}))}enterTransformMode(e){this.isTransformMode=!0,this.furnitureControl.setMode(e),this.furnitureControl.attach(this.selectedObject),this.controls.enableRotate=!1}exitTransformMode(){this.isTransformMode=!1,this.furnitureControl.detach(),this.controls.enableRotate=!0}updateProp(e,t){const o=this.furnitures.find((e=>e.id===this.selectedObject.name));null==o.props&&(o.props={}),o.props[e]=t,this.applyCustomColor(this.selectedObject),this.applyCustomTexture(this.selectedObject)}addFurniture(e){const t={id:(0,v.Z)(),type:e,position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0}};this.furnitures.push(t),this.loadFurniture(t).then((e=>{this.scene.add(e.scene),this.objects.push(e.scene)}))}removeFurniture(){this.exitTransformMode();const e=this.selectedObject;this.scene.remove(e),this.objects=this.objects.filter((t=>t.name!==e.name)),this.furnitures=this.furnitures.filter((t=>t.id!==e.name)),this.selectedObject=null,this.onChangeSelect(null)}removeAllFurnitures(){this.exitTransformMode();for(const e of this.objects)this.scene.remove(e);this.objects=[],this.furnitures=[],this.selectedObject=null,this.onChangeSelect(null)}updateCarpetColor(e){this.roomInfo.carpetColor=e,this.applyCarpetColor()}changeRoomType(e){this.roomInfo.roomType=e,this.scene.remove(this.roomObj),this.loadRoom()}getRoomInfo(){for(const e of this.objects){const t=this.furnitures.find((t=>t.id===e.name));t.position.x=e.position.x,t.position.y=e.position.y,t.position.z=e.position.z,t.rotation.x=e.rotation.x,t.rotation.y=e.rotation.y,t.rotation.z=e.rotation.z}return this.roomInfo}getSelectedObject(){return this.selectedObject}findFurnitureById(e){return this.furnitures.find((t=>t.id===e))}destroy(){window.cancelAnimationFrame(this.renderFrameRequestId),this.controls.dispose(),this.scene.dispose()}}B([w.default],I.prototype,"renderWithoutPostFXs",null),B([w.default],I.prototype,"renderWithPostFXs",null),B([w.default],I.prototype,"loadRoom",null),B([w.default],I.prototype,"loadFurniture",null),B([w.default],I.prototype,"applyCarpetColor",null),B([w.default],I.prototype,"applyCustomColor",null),B([w.default],I.prototype,"applyCustomTexture",null),B([w.default],I.prototype,"onmousemove",null),B([w.default],I.prototype,"onmousedown",null),B([w.default],I.prototype,"getRoot",null),B([w.default],I.prototype,"isSelectedObject",null),B([w.default],I.prototype,"selectFurniture",null),B([w.default],I.prototype,"enterTransformMode",null),B([w.default],I.prototype,"exitTransformMode",null),B([w.default],I.prototype,"updateProp",null),B([w.default],I.prototype,"addFurniture",null),B([w.default],I.prototype,"removeFurniture",null),B([w.default],I.prototype,"removeAllFurnitures",null),B([w.default],I.prototype,"updateCarpetColor",null),B([w.default],I.prototype,"changeRoomType",null),B([w.default],I.prototype,"getRoomInfo",null),B([w.default],I.prototype,"getSelectedObject",null),B([w.default],I.prototype,"findFurnitureById",null),B([w.default],I.prototype,"destroy",null);var R=o(77127),O=o(17505),_=o(51436),$=o(56024),z=o(42453),Q=o(66018),D=o(14975),A=o(10192),X=o(73120);const q=o(29796);let W;const Z=(0,a.defineComponent)({components:{XPreview:O.default,MkButton:z.Z,MkSelect:Q.Z},props:{acct:{type:String,required:!0}},data(){return{INFO:(0,a.computed)((()=>this.user?{title:this.$ts.room,avatar:this.user}:null)),user:null,objectSelected:!1,selectedFurnitureName:null,selectedFurnitureInfo:null,selectedFurnitureProps:null,roomType:null,carpetColor:null,isTranslateMode:!1,isRotateMode:!1,isMyRoom:!1,changed:!1,faBoxOpen:_.IA$,faSave:$.r6,faTrashAlt:$.I7,faUndo:_.X7o,faArrowsAlt:_.Qg3,faBan:_.gPx,faBroom:_.Z$V}},async mounted(){window.addEventListener("beforeunload",this.beforeunload),this.user=await A.hi("users/show",Object.assign({},(0,R.Z)(this.acct))),this.isMyRoom=this.$i&&this.$i.id===this.user.id;const e=await A.hi("room/show",{userId:this.user.id});this.roomType=e.roomType,this.carpetColor=e.carpetColor,W=new I(this.user,this.isMyRoom,e,this.$el,{graphicsQuality:X.cP.get("roomGraphicsQuality"),onChangeSelect:e=>{if(this.objectSelected=null!=e,e){const t=W.findFurnitureById(e.name);this.selectedFurnitureName=this.$t("_rooms._furnitures."+t.type),this.selectedFurnitureInfo=q.find((e=>e.id===t.type)),this.selectedFurnitureProps=t.props?JSON.parse(JSON.stringify(t.props)):null,this.$nextTick((()=>{this.$refs.preview.selected(e)}))}},useOrthographicCamera:X.cP.get("roomUseOrthographicCamera")})},beforeRouteLeave(e,t,o){this.changed?A.WZ({type:"warning",text:this.$ts.leaveConfirm,showCancelButton:!0}).then((({canceled:e})=>{e?o(!1):o()})):o()},beforeUnmount(){W.destroy(),window.removeEventListener("beforeunload",this.beforeunload)},methods:{beforeunload(e){this.changed&&(e.preventDefault(),e.returnValue="")},async add(){const{canceled:e,result:t}=await A.WZ({type:null,title:this.$ts._rooms.addFurniture,select:{items:q.map((e=>({value:e.id,text:this.$t("_rooms._furnitures."+e.id)})))},showCancelButton:!0});e||(W.addFurniture(t),this.changed=!0)},remove(){this.isTranslateMode=!1,this.isRotateMode=!1,W.removeFurniture(),this.changed=!0},save(){A.hi("room/update",{room:W.getRoomInfo()}).then((()=>{this.changed=!1,A.Vp()})).catch((e=>{A.WZ({type:"error",text:e.message})}))},clear(){A.WZ({type:"warning",text:this.$ts._rooms.clearConfirm,showCancelButton:!0}).then((({canceled:e})=>{e||(W.removeAllFurnitures(),this.changed=!0)}))},chooseImage(e,t){(0,D.$)(t.currentTarget||t.target,null,!1).then((t=>{W.updateProp(e,"/proxy/?"+(0,N.I)({url:t.thumbnailUrl})),this.$refs.preview.selected(W.getSelectedObject()),this.changed=!0}))},updateColor(e,t){W.updateProp(e,t.target.value),this.$refs.preview.selected(W.getSelectedObject()),this.changed=!0},updateCarpetColor(e){W.updateCarpetColor(e.target.value),this.carpetColor=e.target.value,this.changed=!0},updateRoomType(e){W.changeRoomType(e),this.roomType=e,this.changed=!0},translate(){this.isTranslateMode?this.exit():(this.isRotateMode=!1,this.isTranslateMode=!0,W.enterTransformMode("translate")),this.changed=!0},rotate(){this.isRotateMode?this.exit():(this.isTranslateMode=!1,this.isRotateMode=!0,W.enterTransformMode("rotate")),this.changed=!0},exit(){this.isTranslateMode=!1,this.isRotateMode=!1,W.exitTransformMode(),this.changed=!0}}});o(41238);Z.render=b,Z.__scopeId="data-v-44801dd2";const K=Z},33599:(e,t,o)=>{var a=o(26051);"string"==typeof a&&(a=[[e.id,a,""]]),a.locals&&(e.exports=a.locals);(0,o(45346).Z)("03940eb0",a,!0,{})},41238:(e,t,o)=>{var a=o(12050);"string"==typeof a&&(a=[[e.id,a,""]]),a.locals&&(e.exports=a.locals);(0,o(45346).Z)("b7b69c10",a,!0,{})}}]);